<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <!-- Font Awesome CSS -->
    <link
      href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link href="/public/owners.css" rel="stylesheet" />
    <style>
      #my_modal {
          display: none;
          width: 300px;
          padding: 20px 60px;
          background-color: #fefefe;
          border: 1px solid #888;
          border-radius: 3px;
      }

      #my_modal .modal_close_btn {
          position: absolute;
          top: 10px;
          right: 10px;
      }
  </style>
    <title>세탁센터 | 사장님</title>
  </head>

  <body>
    <div
      class="jumbotron bg-sparta text-white text-center"
      onclick="window.location.href='/api/laundries/owner/'"
    >
      <h1 class="font-weight-bold">스파르타 세탁소</h1>
    </div>

    <span id="ownerInfo">
      <div class="container" style="margin-top: 50px">
        <h2 class="col" style="text-align: center; margin-bottom: 20px">
          안녕하세요 <%= userName %>님
        </h2>
      </div>

      <div class="container" style="margin-top: 50px">
        <h4 class="col" style="text-align: center; margin-bottom: 20px">
          현재 보유 포인트
        </h4>
        <h4 class="col" style="text-align: center; margin-bottom: 50px">
          <%= userPoint %>점
        </h4>
      </div>
    </span>

    <div class="wrap">
      <div class="row d-flex justify-content-around">
        <div class="col-6 pr-2">
          <button
            onclick="open_laundry_list()"
            type="button"
            class="btn btn-sparta btn-block"
            style="margin-right: 15px"
          >
            내 세탁물 조회 
          </button>
        </div>
        <div class="col-6 pl-2">
          <button
            onclick="open_Laundry_sumbit()"
            type="button"
            class="btn btn-outline-sparta btn-block"
          >
           세탁물 신청
          </button>
        </div>
      </div>
      

    </div>

    <div class="laundry_list" id="viewLaundries">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <table class="table table-bordered" id="laundry_list">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">세탁물</th>
                  <th scope="col">요청사항</th>
                  <th scope="col">사진</th>
                  <th scope="col">상태</th>
                  <th scope="col">생성일</th>
                  <th scope="col">평점</th>
                  <th scope="col">세탁물 취소</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
      <!-- 닫기 버튼-->
      <div class="wrap">
        <div class="row d-flex justify-content-around">
          <div class="col-3 pr-2">
            <button
              onclick="close_laundry_list()"
              type="button"
              class="btn btn-sparta btn-block"
              style="margin-right: 15px"
            >
              닫기
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="laundry_list" id="viewWorkLists">
    <div class="container">
      <div class="row">
        <div class="col-14">
          <table class="table table-bordered" id="viewWorks">
            <thead>
              <tr>
                <th scope="col">세탁물</th>
                <th scope="col">요청사항</th>
                <th scope="col">사진</th>
                <th scope="col">세탁물 상태</th>
                <th scope="col"> 제출하기 </th>
                <th scope="col"> userid=1 </th>
              </tr>
            
              <tr>
                <th scope="col"><input type="text" id="inputlaundryName"></th>
                <th scope="col"><input type="text" id="inputimg"></th>
                <th scope="col"><input type="text" id="inputrequest"></th>
                <th scope="col"><input type="text" id="inputstatus"></th>          
                <th scope="col"> 
                  <button onclick="addToLaundry()" type="submit" class="btn btn-primary">Submit</button>
                </th>
                <th scope="col"><input type="text" id="inputuserId"></th>
              </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>
    <!-- 닫기 버튼-->
    <div class="wrap">
      <div class="row d-flex justify-content-around">
        <div class="col-3 pr-2">
          <button
            onclick="close_laundry_list()"
            type="button"
            class="btn btn-sparta btn-block"
            style="margin-right: 15px"
          >
            닫기
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modalalert-->
    <div
      class="modal text-left"
      id="alertModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="alertModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="alertModalLabel">알림</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="alertText">
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-sparta btn-confirm"
              data-dismiss="modal"
            >
              확인
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
      integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
      crossorigin="anonymous"
    ></script>

    <script src="/api.js"></script>

    <script>
      function open_laundry_list() {
        $('#viewLaundries').show()
        $('#viewWorkLists').hide();
      }

      function close_laundry_list() {
        $('#viewLaundries').hide();
        $('#viewWorkLists').hide();
      }

      function open_Laundry_sumbit() {
        $('#viewWorkLists').show();
        $('#viewLaundries').hide()
      }

      function close_myWork_list() {
        $('#viewWorkLists').hide();
      }

      // 내 세탁물 조회
      $(document).ready(function () {
        laundry_list();
      });
      
      function laundry_list() {
        $.ajax({
          type: 'GET',
          url: '/api/laundries/user/laundry/list',
          data: {},
          success: function (response) {
            let rows = response['myLundry'];
            for (let i = 0; i < rows.length; i++) {
              let laundryId = rows[i]['laundryId'];
              let laundryName = rows[i]['laundryName'];
              let request = rows[i]['request'];
              let img = rows[i]['img'];
              let status = rows[i]['status'];
              let createdAt = rows[i]['createdAt'];
              let review = rows[i]['review'];
              let temp_html = `<tbody>
                                <tr>
                                  <th scope="row">${laundryId}</th>
                                  <td>${laundryName}</td>
                                  <td>${request}</td>
                                  <td>${img}</td>
                                  <td>${status}</td>
                                  <td>${createdAt}</td>
                                  <td>${review}</td>
                                  <td>
                                  <button onclick="deleteLuandry(${laundryId})" type="button" class="btn btn-danger"><i class="fa fa-remove"></i></button>
                                  </td>                                
                                  </tr>
                              </tbody>`;
              $('#laundry_list').append(temp_html);
            }
          },
        });
      }
 
      //세탁물 신청하기
      function addToLaundry() {
        const userId  = $("#inputuserId").val();
        const laundryName = $("#inputlaundryName").val();
        const img = $("#inputimg").val();
        const request = $("#inputrequest").val();
        const status = $("#inputstatus").val();

        $.ajax({
          type: 'POST',
          url: `/api/laundries/user/laundry/newRequest`,
          data: {
            userId: userId,
            laundryName :laundryName,
            img :img,
            request : request,
            status :status
          },
          success: function (response) {
            customAlert(response['msg'], function () {
              window.location.reload();
            });
          },
          error: function (error) {
            customAlert(error.responseJSON.errorMessage);
          }
        });
      }
      
      //평점 주기 
      function updateReview(laundryId) {
        consol.log(laundryId)
        const review = $(`#select_review_${laundryId}`).val();
        console.log(review)
        $.ajax({
          type: 'PUT',
          url: `/api/laundries/user/${laundryId}/review`,
          data: { review },
          success: function (response) {
            customAlert(response['msg'], function () {
              window.location.reload();
            });
          },
        });

      }

      // 작업취소하기
      function deleteLuandry(laundryId) {
        $.ajax({
          type: 'DELETE',
          url: `/api/laundries/user/laundry/list/${laundryId}/delete`,
          data: {},
          success: function (response) {
            customAlert(response['msg'], function () {
              window.location.reload();
            });
          },
        });
      }

      // Modal alert
      function customAlert(text, confirmCallback) {
        $('#alertText').text(text);
        $('#alertModal').modal('show');
        if (confirmCallback) {
          $('#alertModal .btn-confirm').click(confirmCallback);
        }
      }
    </script>
  

  </body>
</html>
